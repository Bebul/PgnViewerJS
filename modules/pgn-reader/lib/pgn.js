!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["pgn-parser"]=t():n["pgn-parser"]=t()}(global,(function(){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="/lib/",e(e.s=2)}([function(n,t,e){"use strict";function r(n,t,e,o){this.message=n,this.expected=t,this.found=e,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}!function(n,t){function e(){this.constructor=n}e.prototype=t.prototype,n.prototype=new e}(r,Error),r.buildMessage=function(n,t){var e={literal:function(n){return'"'+o(n.text)+'"'},class:function(n){var t,e="";for(t=0;t<n.parts.length;t++)e+=n.parts[t]instanceof Array?i(n.parts[t][0])+"-"+i(n.parts[t][1]):i(n.parts[t]);return"["+(n.inverted?"^":"")+e+"]"},any:function(n){return"any character"},end:function(n){return"end of input"},other:function(n){return n.description}};function r(n){return n.charCodeAt(0).toString(16).toUpperCase()}function o(n){return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(n){return"\\x0"+r(n)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(n){return"\\x"+r(n)}))}function i(n){return n.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(n){return"\\x0"+r(n)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(n){return"\\x"+r(n)}))}return"Expected "+function(n){var t,r,o,i=new Array(n.length);for(t=0;t<n.length;t++)i[t]=(o=n[t],e[o.type](o));if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(n)+" but "+function(n){return n?'"'+o(n)+'"':"end of input"}(t)+" found."},n.exports={SyntaxError:r,parse:function(n,t){t=void 0!==t?t:{};var e,o={},i={pgn:jt,tags:Lt,game:function(){var n,t,e;n=Et,(t=Lt())===o&&(t=null);t!==o&&(e=jt())!==o?(n,t={tags:t,moves:e[0]},n=t):(Et=n,n=o);return n}},u=jt,a=function(n,t){return t},l=_t("Event",!1),c=_t("Site",!1),s=_t("Date",!1),f=_t("Round",!1),v=_t("White",!1),p=_t("Black",!1),h=_t("Result",!1),g=_t("WhiteTitle",!1),d=_t("BlackTitle",!1),m=_t("WhiteELO",!1),A=_t("BlackELO",!1),b=_t("WhiteUSCF",!1),C=_t("BlackUSCF",!1),E=_t("WhiteNA",!1),y=_t("BlackNA",!1),S=_t("WhiteType",!1),N=_t("BlackType",!1),T=_t("EventDate",!1),_=_t("EventSponsor",!1),x=_t("Section",!1),O=_t("Stage",!1),k=_t("Board",!1),w=_t("Opening",!1),P=_t("Variation",!1),G=_t("SubVariation",!1),L=_t("ECO",!1),R=_t("NIC",!1),I=_t("Time",!1),D=_t("UTCTime",!1),U=_t("UTCDate",!1),B=_t("TimeControl",!1),$=_t("SetUp",!1),M=_t("FEN",!1),F=_t("Termination",!1),j=_t("Annotator",!1),q=_t("Mode",!1),W=_t("PlyCount",!1),Q=Ot("whitespace"),K=/^[ \t\n\r]/,V=xt([" ","\t","\n","\r"],!1,!1),Y=Ot("string"),H=_t('"',!1),Z=/^[^\0-\x1F"\\]/,z=xt([["\0",""],'"',"\\"],!0,!1),X=/^[0-9]/,J=xt([["0","9"]],!1,!1),nn=_t(".",!1),tn=_t("1-0",!1),en=_t("1:0",!1),rn=_t("0-1",!1),on=_t("0:1",!1),un=_t("1/2-1/2",!1),an=_t("*",!1),ln=_t("-",!1),cn=function(n){return parseInt(n.join(""),10)},sn=/^[^}]/,fn=xt(["}"],!0,!1),vn=_t("%csl",!1),pn=_t("%cal",!1),hn=_t(",",!1),gn=function(n,t){var e=[];e.push(n);for(var r=0;r<t.length;r++)e.push(t[r][2]);return e},dn=_t("Y",!1),mn=_t("G",!1),An=_t("R",!1),bn=_t("B",!1),Cn=_t("{",!1),En=_t("}",!1),yn=_t("[",!1),Sn=_t("]",!1),Nn=_t("%",!1),Tn=_t("clk",!1),_n=_t("egt",!1),xn=_t("emt",!1),On=_t("mct",!1),kn=_t(":",!1),wn=_t("(",!1),Pn=_t(")",!1),Gn=Ot("integer"),Ln=_t(" ",!1),Rn=_t("O-O-O",!1),In=_t("O-O",!1),Dn=_t("+-",!1),Un=_t("+",!1),Bn=function(n){return n[1]},$n=_t("$$$",!1),Mn=_t("#",!1),Fn=_t("=",!1),jn=_t("$",!1),qn=_t("!!",!1),Wn=_t("??",!1),Qn=_t("!?",!1),Kn=_t("?!",!1),Vn=_t("!",!1),Yn=_t("?",!1),Hn=_t("‼",!1),Zn=_t("⁇",!1),zn=_t("⁉",!1),Xn=_t("⁈",!1),Jn=_t("□",!1),nt=_t("∞",!1),tt=_t("⩲",!1),et=_t("⩱",!1),rt=_t("±",!1),ot=_t("∓",!1),it=_t("-+",!1),ut=_t("⨀",!1),at=_t("⟳",!1),lt=_t("→",!1),ct=_t("↑",!1),st=_t("⇆",!1),ft=_t("D",!1),vt=/^[RNBQKP]/,pt=xt(["R","N","B","Q","K","P"],!1,!1),ht=/^[RNBQ]/,gt=xt(["R","N","B","Q"],!1,!1),dt=/^[a-h]/,mt=xt([["a","h"]],!1,!1),At=/^[1-8]/,bt=xt([["1","8"]],!1,!1),Ct=_t("x",!1),Et=0,yt=[{line:1,column:1}],St=0,Nt=[],Tt=0;if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');u=i[t.startRule]}function _t(n,t){return{type:"literal",text:n,ignoreCase:t}}function xt(n,t,e){return{type:"class",parts:n,inverted:t,ignoreCase:e}}function Ot(n){return{type:"other",description:n}}function kt(t){var e,r=yt[t];if(r)return r;for(e=t-1;!yt[e];)e--;for(r={line:(r=yt[e]).line,column:r.column};e<t;)10===n.charCodeAt(e)?(r.line++,r.column=1):r.column++,e++;return yt[t]=r,r}function wt(n,t){var e=kt(n),r=kt(t);return{start:{offset:n,line:e.line,column:e.column},end:{offset:t,line:r.line,column:r.column}}}function Pt(n){Et<St||(Et>St&&(St=Et,Nt=[]),Nt.push(n))}function Gt(n,t,e){return new r(r.buildMessage(n,t),n,t,e)}function Lt(){var n,t,e,r,i,u,l,c;if(n=Et,It()!==o){if(t=Et,(e=Rt())!==o){for(r=[],i=Et,It()!==o&&(u=Rt())!==o?(i,i=a(0,u)):(Et=i,i=o);i!==o;)r.push(i),i=Et,It()!==o&&(u=Rt())!==o?(i,i=a(0,u)):(Et=i,i=o);r!==o?(t,c={},[e].concat(r).forEach((function(n){c[n.name]=n.value})),t=e=c):(Et=t,t=o)}else Et=t,t=o;t===o&&(t=null),t!==o&&(e=It())!==o?(n,n=null!==(l=t)?l:{}):(Et=n,n=o)}else Et=n,n=o;return n}function Rt(){var t,e;return t=Et,re()!==o&&(e=function(){var t,e,r;t=Et,(e=function(){var t;"Event"===n.substr(Et,5)?(t="Event",Et+=5):(t=o,0===Tt&&Pt(l));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,t=e={name:"Event",value:r}):(Et=t,t=o);t===o&&(t=Et,(e=function(){var t;"Site"===n.substr(Et,4)?(t="Site",Et+=4):(t=o,0===Tt&&Pt(c));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Site",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Date"===n.substr(Et,4)?(t="Date",Et+=4):(t=o,0===Tt&&Pt(s));return t}())!==o&&It()!==o&&(r=$t())!==o?(t,e=function(n){return{name:"Date",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Round"===n.substr(Et,5)?(t="Round",Et+=5):(t=o,0===Tt&&Pt(f));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Round",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"White"===n.substr(Et,5)?(t="White",Et+=5):(t=o,0===Tt&&Pt(v));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"White",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Black"===n.substr(Et,5)?(t="Black",Et+=5):(t=o,0===Tt&&Pt(p));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Black",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Result"===n.substr(Et,6)?(t="Result",Et+=6):(t=o,0===Tt&&Pt(h));return t}())!==o&&It()!==o&&(r=function(){var t,e;t=Et,Ut()!==o&&(e=function(){var t,e;t=Et,"1-0"===n.substr(Et,3)?(e="1-0",Et+=3):(e=o,0===Tt&&Pt(tn));e!==o&&(t,e=e);(t=e)===o&&(t=Et,"1:0"===n.substr(Et,3)?(e="1:0",Et+=3):(e=o,0===Tt&&Pt(en)),e!==o&&(t,e=e),(t=e)===o&&(t=Et,"0-1"===n.substr(Et,3)?(e="0-1",Et+=3):(e=o,0===Tt&&Pt(rn)),e!==o&&(t,e=e),(t=e)===o&&(t=Et,"0:1"===n.substr(Et,3)?(e="0:1",Et+=3):(e=o,0===Tt&&Pt(on)),e!==o&&(t,e=e),(t=e)===o&&(t=Et,"1/2-1/2"===n.substr(Et,7)?(e="1/2-1/2",Et+=7):(e=o,0===Tt&&Pt(un)),e!==o&&(t,e=e),(t=e)===o&&(t=Et,42===n.charCodeAt(Et)?(e="*",Et++):(e=o,0===Tt&&Pt(an)),e!==o&&(t,e=e),t=e)))));return t}())!==o&&Ut()!==o?(t,t=e):(Et=t,t=o);return t}())!==o?(t,e=function(n){return{name:"Result",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"WhiteTitle"===n.substr(Et,10)?(t="WhiteTitle",Et+=10):(t=o,0===Tt&&Pt(g));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"WhiteTitle",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"BlackTitle"===n.substr(Et,10)?(t="BlackTitle",Et+=10):(t=o,0===Tt&&Pt(d));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"BlackTitle",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"WhiteELO"===n.substr(Et,8)?(t="WhiteELO",Et+=8):(t=o,0===Tt&&Pt(m));return t}())!==o&&It()!==o&&(r=Mt())!==o?(t,e=function(n){return{name:"WhiteELO",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"BlackELO"===n.substr(Et,8)?(t="BlackELO",Et+=8):(t=o,0===Tt&&Pt(A));return t}())!==o&&It()!==o&&(r=Mt())!==o?(t,e=function(n){return{name:"BlackELO",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"WhiteUSCF"===n.substr(Et,9)?(t="WhiteUSCF",Et+=9):(t=o,0===Tt&&Pt(b));return t}())!==o&&It()!==o&&(r=Ft())!==o?(t,e=function(n){return{name:"WhiteUSCF",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"BlackUSCF"===n.substr(Et,9)?(t="BlackUSCF",Et+=9):(t=o,0===Tt&&Pt(C));return t}())!==o&&It()!==o&&(r=Ft())!==o?(t,e=function(n){return{name:"BlackUSCF",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"WhiteNA"===n.substr(Et,7)?(t="WhiteNA",Et+=7):(t=o,0===Tt&&Pt(E));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"WhiteNA",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"BlackNA"===n.substr(Et,7)?(t="BlackNA",Et+=7):(t=o,0===Tt&&Pt(y));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"BlackNA",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"WhiteType"===n.substr(Et,9)?(t="WhiteType",Et+=9):(t=o,0===Tt&&Pt(S));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"WhiteType",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"BlackType"===n.substr(Et,9)?(t="BlackType",Et+=9):(t=o,0===Tt&&Pt(N));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"BlackType",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"EventDate"===n.substr(Et,9)?(t="EventDate",Et+=9):(t=o,0===Tt&&Pt(T));return t}())!==o&&It()!==o&&(r=$t())!==o?(t,e=function(n){return{name:"EventDate",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"EventSponsor"===n.substr(Et,12)?(t="EventSponsor",Et+=12):(t=o,0===Tt&&Pt(_));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"EventSponsor",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Section"===n.substr(Et,7)?(t="Section",Et+=7):(t=o,0===Tt&&Pt(x));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Section",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Stage"===n.substr(Et,5)?(t="Stage",Et+=5):(t=o,0===Tt&&Pt(O));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Stage",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Board"===n.substr(Et,5)?(t="Board",Et+=5):(t=o,0===Tt&&Pt(k));return t}())!==o&&It()!==o&&(r=Ft())!==o?(t,e=function(n){return{name:"Board",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Opening"===n.substr(Et,7)?(t="Opening",Et+=7):(t=o,0===Tt&&Pt(w));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Opening",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Variation"===n.substr(Et,9)?(t="Variation",Et+=9):(t=o,0===Tt&&Pt(P));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Variation",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"SubVariation"===n.substr(Et,12)?(t="SubVariation",Et+=12):(t=o,0===Tt&&Pt(G));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"SubVariation",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"ECO"===n.substr(Et,3)?(t="ECO",Et+=3):(t=o,0===Tt&&Pt(L));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"ECO",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"NIC"===n.substr(Et,3)?(t="NIC",Et+=3):(t=o,0===Tt&&Pt(R));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"NIC",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Time"===n.substr(Et,4)?(t="Time",Et+=4):(t=o,0===Tt&&Pt(I));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Time",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"UTCTime"===n.substr(Et,7)?(t="UTCTime",Et+=7):(t=o,0===Tt&&Pt(D));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"UTCTime",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"UTCDate"===n.substr(Et,7)?(t="UTCDate",Et+=7):(t=o,0===Tt&&Pt(U));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"UTCDate",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"TimeControl"===n.substr(Et,11)?(t="TimeControl",Et+=11):(t=o,0===Tt&&Pt(B));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"TimeControl",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"SetUp"===n.substr(Et,5)?(t="SetUp",Et+=5):(t=o,0===Tt&&Pt($));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"SetUp",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"FEN"===n.substr(Et,3)?(t="FEN",Et+=3):(t=o,0===Tt&&Pt(M));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"FEN",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Termination"===n.substr(Et,11)?(t="Termination",Et+=11):(t=o,0===Tt&&Pt(F));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Termination",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Annotator"===n.substr(Et,9)?(t="Annotator",Et+=9):(t=o,0===Tt&&Pt(j));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Annotator",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"Mode"===n.substr(Et,4)?(t="Mode",Et+=4):(t=o,0===Tt&&Pt(q));return t}())!==o&&It()!==o&&(r=Dt())!==o?(t,e=function(n){return{name:"Mode",value:n}}(r),t=e):(Et=t,t=o),t===o&&(t=Et,(e=function(){var t;"PlyCount"===n.substr(Et,8)?(t="PlyCount",Et+=8):(t=o,0===Tt&&Pt(W));return t}())!==o&&It()!==o&&(r=Ft())!==o?(t,e=function(n){return{name:"PlyCount",value:n}}(r),t=e):(Et=t,t=o)))))))))))))))))))))))))))))))))))));return t}())!==o&&oe()!==o?(t,t=e):(Et=t,t=o),t}function It(){var t,e;for(Tt++,t=[],K.test(n.charAt(Et))?(e=n.charAt(Et),Et++):(e=o,0===Tt&&Pt(V));e!==o;)t.push(e),K.test(n.charAt(Et))?(e=n.charAt(Et),Et++):(e=o,0===Tt&&Pt(V));return Tt--,t===o&&(e=o,0===Tt&&Pt(Q)),t}function Dt(){var n,t,e;if(Tt++,n=Et,Ut()!==o){for(t=[],e=Bt();e!==o;)t.push(e),e=Bt();t!==o&&(e=Ut())!==o?(n,n=t.join("")):(Et=n,n=o)}else Et=n,n=o;return Tt--,n===o&&(o,0===Tt&&Pt(Y)),n}function Ut(){var t;return 34===n.charCodeAt(Et)?(t='"',Et++):(t=o,0===Tt&&Pt(H)),t}function Bt(){var t;return Z.test(n.charAt(Et))?(t=n.charAt(Et),Et++):(t=o,0===Tt&&Pt(z)),t}function $t(){var t,e,r,i,u,a,l,c,s,f;return t=Et,Ut()!==o?(e=Et,X.test(n.charAt(Et))?(r=n.charAt(Et),Et++):(r=o,0===Tt&&Pt(J)),r!==o?(X.test(n.charAt(Et))?(i=n.charAt(Et),Et++):(i=o,0===Tt&&Pt(J)),i!==o?(X.test(n.charAt(Et))?(u=n.charAt(Et),Et++):(u=o,0===Tt&&Pt(J)),u!==o?(X.test(n.charAt(Et))?(a=n.charAt(Et),Et++):(a=o,0===Tt&&Pt(J)),a!==o?e=r=[r,i,u,a]:(Et=e,e=o)):(Et=e,e=o)):(Et=e,e=o)):(Et=e,e=o),e!==o?(46===n.charCodeAt(Et)?(r=".",Et++):(r=o,0===Tt&&Pt(nn)),r!==o?(i=Et,X.test(n.charAt(Et))?(u=n.charAt(Et),Et++):(u=o,0===Tt&&Pt(J)),u!==o?(X.test(n.charAt(Et))?(a=n.charAt(Et),Et++):(a=o,0===Tt&&Pt(J)),a!==o?i=u=[u,a]:(Et=i,i=o)):(Et=i,i=o),i!==o?(46===n.charCodeAt(Et)?(u=".",Et++):(u=o,0===Tt&&Pt(nn)),u!==o?(a=Et,X.test(n.charAt(Et))?(l=n.charAt(Et),Et++):(l=o,0===Tt&&Pt(J)),l!==o?(X.test(n.charAt(Et))?(c=n.charAt(Et),Et++):(c=o,0===Tt&&Pt(J)),c!==o?a=l=[l,c]:(Et=a,a=o)):(Et=a,a=o),a!==o&&(l=Ut())!==o?(t,s=i,f=a,t=e.join("")+"."+s.join("")+"."+f.join("")):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o),t}function Mt(){var t,e,r,i;return(t=Ft())===o&&(t=Et,(e=Ut())!==o?(45===n.charCodeAt(Et)?(r="-",Et++):(r=o,0===Tt&&Pt(ln)),r!==o&&(i=Ut())!==o?t=e=[e,r,i]:(Et=t,t=o)):(Et=t,t=o)),t}function Ft(){var t,e,r;if(t=Et,Ut()!==o){if(e=[],X.test(n.charAt(Et))?(r=n.charAt(Et),Et++):(r=o,0===Tt&&Pt(J)),r!==o)for(;r!==o;)e.push(r),X.test(n.charAt(Et))?(r=n.charAt(Et),Et++):(r=o,0===Tt&&Pt(J));else e=o;e!==o&&(r=Ut())!==o?(t,t=cn(e)):(Et=t,t=o)}else Et=t,t=o;return t}function jt(){var n,t,e,r,i;return n=Et,(t=function(){var n,t;n=Et,(t=Wt())!==o&&(n,t=t);return n=t}())!==o?((e=Qt())===o&&(e=null),e!==o?(n,r=t,(i=e||[]).unshift(r),n=t=i):(Et=n,n=o)):(Et=n,n=o),n===o&&(n=Et,(t=qt())!==o?((e=Wt())===o&&(e=null),e!==o?(n,n=t=function(n,t){var e=t||[];return e.unshift(n),e}(t,e)):(Et=n,n=o)):(Et=n,n=o),n===o&&(n=Et,(t=se())===o&&(t=null),t!==o&&(n,t=[[]]),n=t)),n}function qt(){var n,t;return n=Et,(t=Qt())!==o&&(n,t=t),n=t}function Wt(){var n,t,e,r,i,u,a,l,c,s,f,v,p,h,g,d,m,A,b,C,E,y,S,N,T,_,x;return n=Et,(t=se())===o&&(t=null),t!==o?((e=Vt())===o&&(e=null),e!==o?((r=se())===o&&(r=null),r!==o?((i=le())===o&&(i=null),i!==o?((u=se())===o&&(u=null),u!==o?((a=Vt())===o&&(a=null),a!==o?((l=se())===o&&(l=null),l!==o&&(c=ve())!==o?((s=se())===o&&(s=null),s!==o?((f=ge())===o&&(f=null),f!==o?((v=se())===o&&(v=null),v!==o?((p=Vt())===o&&(p=null),p!==o?((h=se())===o&&(h=null),h!==o?((g=Ht())===o&&(g=null),g!==o?((d=se())===o&&(d=null),d!==o?((m=function n(){var t,e,r,i,u,a;t=Et,ue()!==o&&(e=Wt())!==o&&ae()!==o?((r=se())===o&&(r=null),r!==o?((i=n())===o&&(i=null),i!==o?((u=se())===o&&(u=null),u!==o?((a=le())===o&&(a=null),a!==o?(t,l=e,(c=i||[]).unshift(l),t=c):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o);var l,c;return t}())===o&&(m=null),m!==o?((A=Qt())===o&&(A=null),A!==o?(n,b=e,C=a,E=c,y=f,S=p,N=g,T=m,_=A||[],(x={turn:"w"}).moveNumber=i,x.notation=E,x.commentBefore=C,x.commentAfter=S,x.commentMove=b,x.variations=T||[],x.nag=y||null,_.unshift(x),x.commentDiag=N,n=t=_):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o),n===o&&(n=Kt()),n}function Qt(){var n,t,e,r,i,u,a,l,c,s,f,v,p,h,g,d,m,A,b,C,E,y,S,N,T,_,x;return n=Et,(t=se())===o&&(t=null),t!==o?((e=Vt())===o&&(e=null),e!==o?((r=se())===o&&(r=null),r!==o?((i=le())===o&&(i=null),i!==o?((u=se())===o&&(u=null),u!==o?((a=Vt())===o&&(a=null),a!==o?((l=se())===o&&(l=null),l!==o&&(c=ve())!==o?((s=se())===o&&(s=null),s!==o?((f=ge())===o&&(f=null),f!==o?((v=se())===o&&(v=null),v!==o?((p=Vt())===o&&(p=null),p!==o?((h=se())===o&&(h=null),h!==o?((g=Ht())===o&&(g=null),g!==o?((d=se())===o&&(d=null),d!==o?((m=function n(){var t,e,r,i;t=Et,ue()!==o&&(e=qt())!==o&&ae()!==o?((r=se())===o&&(r=null),r!==o?((i=n())===o&&(i=null),i!==o?(t,u=e,(a=i||[]).unshift(u),t=a):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o);var u,a;return t}())===o&&(m=null),m!==o?((A=Wt())===o&&(A=null),A!==o?(n,b=e,C=a,E=c,y=f,S=p,N=g,T=m,_=A||[],(x={turn:"b"}).moveNumber=i,x.notation=E,x.commentBefore=C,x.commentAfter=S,x.commentMove=b,x.variations=T||[],_.unshift(x),x.nag=y||null,x.commentDiag=N,n=t=_):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o),n===o&&(n=Kt()),n}function Kt(){var t,e,r;return t=Et,"1:0"===n.substr(Et,3)?(e="1:0",Et+=3):(e=o,0===Tt&&Pt(en)),e!==o?((r=se())===o&&(r=null),r!==o?(t,t=e=["1:0"]):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,"0:1"===n.substr(Et,3)?(e="0:1",Et+=3):(e=o,0===Tt&&Pt(on)),e!==o?((r=se())===o&&(r=null),r!==o?(t,t=e=["0:1"]):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,"1-0"===n.substr(Et,3)?(e="1-0",Et+=3):(e=o,0===Tt&&Pt(tn)),e!==o?((r=se())===o&&(r=null),r!==o?(t,t=e=["1-0"]):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,"0-1"===n.substr(Et,3)?(e="0-1",Et+=3):(e=o,0===Tt&&Pt(rn)),e!==o?((r=se())===o&&(r=null),r!==o?(t,t=e=["0-1"]):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,"1/2-1/2"===n.substr(Et,7)?(e="1/2-1/2",Et+=7):(e=o,0===Tt&&Pt(un)),e!==o?((r=se())===o&&(r=null),r!==o?(t,t=e=["1/2-1/2"]):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,42===n.charCodeAt(Et)?(e="*",Et++):(e=o,0===Tt&&Pt(an)),e!==o?((r=se())===o&&(r=null),r!==o?(t,t=e=["*"]):(Et=t,t=o)):(Et=t,t=o)))))),t}function Vt(){var n,t,e,r,i,u;if(n=Et,(t=Yt())!==o){for(e=[],r=Et,(i=se())===o&&(i=null),i!==o&&(u=Yt())!==o?r=i=[i,u]:(Et=r,r=o);r!==o;)e.push(r),r=Et,(i=se())===o&&(i=null),i!==o&&(u=Yt())!==o?r=i=[i,u]:(Et=r,r=o);e!==o?(n,n=t=function(n,t){for(var e=n,r=0;r<t.length;r++)e+=" "+t[r][1];return e}(t,e)):(Et=n,n=o)}else Et=n,n=o;return n}function Yt(){var t,e,r,i,u;if(t=Et,e=Et,Tt++,r=Ht(),Tt--,r===o?e=void 0:(Et=e,e=o),e!==o)if((r=te())!==o){if(i=[],sn.test(n.charAt(Et))?(u=n.charAt(Et),Et++):(u=o,0===Tt&&Pt(fn)),u!==o)for(;u!==o;)i.push(u),sn.test(n.charAt(Et))?(u=n.charAt(Et),Et++):(u=o,0===Tt&&Pt(fn));else i=o;i!==o&&(u=ee())!==o?(t,t=e=i.join("").trim()):(Et=t,t=o)}else Et=t,t=o;else Et=t,t=o;return t}function Ht(){var n,t,e,r;return n=Et,te()!==o?((t=se())===o&&(t=null),t!==o&&(e=function(){var n,t,e,r,i;if(n=Et,(t=Zt())!==o)if((e=se())===o&&(e=null),e!==o){for(r=[],i=Zt();i!==o;)r.push(i),i=Zt();r!==o?(n,t=function(n,t){if(t){var e=t[0];return{...n,...e}}return n}(t,r),n=t):(Et=n,n=o)}else Et=n,n=o;else Et=n,n=o;return n}())!==o?((r=se())===o&&(r=null),r!==o&&ee()!==o?(n,n=e):(Et=n,n=o)):(Et=n,n=o)):(Et=n,n=o),n}function Zt(){var t,e,r;return t=Et,(e=function(){var t,e,r,i,u;t=Et,re()!==o?((e=se())===o&&(e=null),e!==o?("%csl"===n.substr(Et,4)?(r="%csl",Et+=4):(r=o,0===Tt&&Pt(vn)),r!==o&&se()!==o&&(i=function(){var t,e,r,i,u,a,l,c;if(t=Et,(e=zt())!==o)if((r=se())===o&&(r=null),r!==o){for(i=[],u=Et,44===n.charCodeAt(Et)?(a=",",Et++):(a=o,0===Tt&&Pt(hn)),a!==o?((l=se())===o&&(l=null),l!==o&&(c=zt())!==o?u=a=[a,l,c]:(Et=u,u=o)):(Et=u,u=o);u!==o;)i.push(u),u=Et,44===n.charCodeAt(Et)?(a=",",Et++):(a=o,0===Tt&&Pt(hn)),a!==o?((l=se())===o&&(l=null),l!==o&&(c=zt())!==o?u=a=[a,l,c]:(Et=u,u=o)):(Et=u,u=o);i!==o?(t,e=gn(e,i),t=e):(Et=t,t=o)}else Et=t,t=o;else Et=t,t=o;return t}())!==o?((u=se())===o&&(u=null),u!==o&&oe()!==o?(t,t=i):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o);return t}())!==o&&(t,(r={}).colorFields=e,e=r),(t=e)===o&&(t=Et,(e=function(){var t,e,r,i,u;t=Et,re()!==o?((e=se())===o&&(e=null),e!==o?("%cal"===n.substr(Et,4)?(r="%cal",Et+=4):(r=o,0===Tt&&Pt(pn)),r!==o&&se()!==o&&(i=function(){var t,e,r,i,u,a,l,c;if(t=Et,(e=Xt())!==o)if((r=se())===o&&(r=null),r!==o){for(i=[],u=Et,44===n.charCodeAt(Et)?(a=",",Et++):(a=o,0===Tt&&Pt(hn)),a!==o?((l=se())===o&&(l=null),l!==o&&(c=Xt())!==o?u=a=[a,l,c]:(Et=u,u=o)):(Et=u,u=o);u!==o;)i.push(u),u=Et,44===n.charCodeAt(Et)?(a=",",Et++):(a=o,0===Tt&&Pt(hn)),a!==o?((l=se())===o&&(l=null),l!==o&&(c=Xt())!==o?u=a=[a,l,c]:(Et=u,u=o)):(Et=u,u=o);i!==o?(t,e=gn(e,i),t=e):(Et=t,t=o)}else Et=t,t=o;else Et=t,t=o;return t}())!==o?((u=se())===o&&(u=null),u!==o&&oe()!==o?(t,t=i):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o);return t}())!==o&&(t,e=function(n){var t={};return t.colorArrows=n,t}(e)),(t=e)===o&&(t=Et,(e=function(){var t,e,r,i,u,a,l;t=Et,(e=re())!==o?((r=se())===o&&(r=null),r!==o?(37===n.charCodeAt(Et)?(i="%",Et++):(i=o,0===Tt&&Pt(Nn)),i!==o&&(u=function(){var t,e;t=Et,"clk"===n.substr(Et,3)?(e="clk",Et+=3):(e=o,0===Tt&&Pt(Tn));e!==o&&(t,e="clk");(t=e)===o&&(t=Et,"egt"===n.substr(Et,3)?(e="egt",Et+=3):(e=o,0===Tt&&Pt(_n)),e!==o&&(t,e="egt"),(t=e)===o&&(t=Et,"emt"===n.substr(Et,3)?(e="emt",Et+=3):(e=o,0===Tt&&Pt(xn)),e!==o&&(t,e="emt"),(t=e)===o&&(t=Et,"mct"===n.substr(Et,3)?(e="mct",Et+=3):(e=o,0===Tt&&Pt(On)),e!==o&&(t,e="mct"),t=e)));return t}())!==o&&se()!==o&&(a=function(){var t,e,r,i,u,a,l,c,s;t=Et,(e=ie())!==o?((r=ie())===o&&(r=null),r!==o?(58===n.charCodeAt(Et)?(i=":",Et++):(i=o,0===Tt&&Pt(kn)),i!==o&&(u=ie())!==o&&(a=ie())!==o?(58===n.charCodeAt(Et)?(l=":",Et++):(l=o,0===Tt&&Pt(kn)),l!==o&&(c=ie())!==o&&(s=ie())!==o?(t,e=function(n,t,e,r,o,i){var u=n;return t&&(u+=t),u+=":"+e+r+":"+o+i}(e,r,u,a,c,s),t=e):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o);return t}())!==o?((l=se())===o&&(l=null),l!==o&&oe()!==o?(t,e=function(n,t){var e={};return e.type=n,e.value=t,e}(u,a),t=e):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o);return t}())!==o&&(t,e=function(n){var t={};return t.clock=n,t}(e)),t=e)),t}function zt(){var n,t,e;return n=Et,(t=Jt())!==o&&(e=ne())!==o?(n,n=t=t+e):(Et=n,n=o),n}function Xt(){var n,t,e,r;return n=Et,(t=Jt())!==o&&(e=ne())!==o&&(r=ne())!==o?(n,n=t=t+e+r):(Et=n,n=o),n}function Jt(){var t,e;return t=Et,89===n.charCodeAt(Et)?(e="Y",Et++):(e=o,0===Tt&&Pt(dn)),e!==o&&(t,e="Y"),(t=e)===o&&(t=Et,71===n.charCodeAt(Et)?(e="G",Et++):(e=o,0===Tt&&Pt(mn)),e!==o&&(t,e="G"),(t=e)===o&&(t=Et,82===n.charCodeAt(Et)?(e="R",Et++):(e=o,0===Tt&&Pt(An)),e!==o&&(t,e="R"),(t=e)===o&&(t=Et,66===n.charCodeAt(Et)?(e="B",Et++):(e=o,0===Tt&&Pt(bn)),e!==o&&(t,e="B"),t=e))),t}function ne(){var n,t,e;return n=Et,(t=Ae())!==o&&(e=be())!==o?(n,n=t=t+e):(Et=n,n=o),n}function te(){var t;return 123===n.charCodeAt(Et)?(t="{",Et++):(t=o,0===Tt&&Pt(Cn)),t}function ee(){var t;return 125===n.charCodeAt(Et)?(t="}",Et++):(t=o,0===Tt&&Pt(En)),t}function re(){var t;return 91===n.charCodeAt(Et)?(t="[",Et++):(t=o,0===Tt&&Pt(yn)),t}function oe(){var t;return 93===n.charCodeAt(Et)?(t="]",Et++):(t=o,0===Tt&&Pt(Sn)),t}function ie(){var t,e;return t=Et,X.test(n.charAt(Et))?(e=n.charAt(Et),Et++):(e=o,0===Tt&&Pt(J)),e!==o&&(t,e=e),t=e}function ue(){var t;return 40===n.charCodeAt(Et)?(t="(",Et++):(t=o,0===Tt&&Pt(wn)),t}function ae(){var t;return 41===n.charCodeAt(Et)?(t=")",Et++):(t=o,0===Tt&&Pt(Pn)),t}function le(){var n,t,e,r;if(n=Et,(t=ce())!==o){for(e=[],r=fe();r!==o;)e.push(r),r=fe();e!==o?(n,n=t=t):(Et=n,n=o)}else Et=n,n=o;return n}function ce(){var t,e,r;if(Tt++,t=Et,e=[],X.test(n.charAt(Et))?(r=n.charAt(Et),Et++):(r=o,0===Tt&&Pt(J)),r!==o)for(;r!==o;)e.push(r),X.test(n.charAt(Et))?(r=n.charAt(Et),Et++):(r=o,0===Tt&&Pt(J));else e=o;return e!==o&&(t,e=cn(e)),Tt--,(t=e)===o&&(e=o,0===Tt&&Pt(Gn)),t}function se(){var t,e,r;if(t=Et,e=[],32===n.charCodeAt(Et)?(r=" ",Et++):(r=o,0===Tt&&Pt(Ln)),r!==o)for(;r!==o;)e.push(r),32===n.charCodeAt(Et)?(r=" ",Et++):(r=o,0===Tt&&Pt(Ln));else e=o;return e!==o&&(t,e=""),t=e}function fe(){var t;return(t=function(){var t;return 46===n.charCodeAt(Et)?(t=".",Et++):(t=o,0===Tt&&Pt(nn)),t}())===o&&(t=se()),t}function ve(){var t,e,r,i,u,a,l,c,s,f,v,p,h,g,d,m,A;return t=Et,(e=me())===o&&(e=null),e!==o?(r=Et,Tt++,i=function(){var n,t,e,r,i;n=Et,(t=de())!==o?((e=Ce())===o&&(e=null),e!==o&&(r=Ae())!==o&&(i=be())!==o?n=t=[t,e,r,i]:(Et=n,n=o)):(Et=n,n=o);return n}(),Tt--,i!==o?(Et=r,r=void 0):r=o,r!==o&&(i=de())!==o?((u=Ce())===o&&(u=null),u!==o&&(a=Ae())!==o&&(l=be())!==o?((c=he())===o&&(c=null),c!==o?((s=pe())===o&&(s=null),s!==o?(t,v=i,p=u,h=a,g=l,d=c,m=s,(A={}).fig=(f=e)||null,A.disc=v||null,A.strike=p||null,A.col=h,A.row=g,A.check=m||null,A.promotion=d,A.notation=(f||"")+(v||"")+(p||"")+h+g+(d||"")+(m||""),t=e=A):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,(e=me())===o&&(e=null),e!==o&&(r=Ae())!==o&&(i=be())!==o?((u=function(){var t;120===n.charCodeAt(Et)?(t="x",Et++):(t=o,0===Tt&&Pt(Ct));t===o&&(45===n.charCodeAt(Et)?(t="-",Et++):(t=o,0===Tt&&Pt(ln)));return t}())===o&&(u=null),u!==o&&(a=Ae())!==o&&(l=be())!==o?((c=he())===o&&(c=null),c!==o?((s=pe())===o&&(s=null),s!==o?(t,t=e=function(n,t,e,r,o,i,u,a){var l={};return l.fig=n||null,l.strike="x"==r?r:null,l.col=o,l.row=i,l.check=a||null,l.notation=(n&&"P"!==n?n:"")+t+e+("x"==r?r:"-")+o+i+(u||"")+(a||""),l.promotion=u,l}(e,r,i,u,a,l,c,s)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,(e=me())===o&&(e=null),e!==o?((r=Ce())===o&&(r=null),r!==o&&(i=Ae())!==o&&(u=be())!==o?((a=he())===o&&(a=null),a!==o?((l=pe())===o&&(l=null),l!==o?(t,t=e=function(n,t,e,r,o,i){var u={};return u.fig=n||null,u.strike=t||null,u.col=e,u.row=r,u.check=i||null,u.notation=(n||"")+(t||"")+e+r+(o||"")+(i||""),u.promotion=o,u}(e,r,i,u,a,l)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,"O-O-O"===n.substr(Et,5)?(e="O-O-O",Et+=5):(e=o,0===Tt&&Pt(Rn)),e!==o?((r=pe())===o&&(r=null),r!==o?(t,t=e=function(n){var t={};return t.notation="O-O-O"+(n||""),t.check=n||null,t}(r)):(Et=t,t=o)):(Et=t,t=o),t===o&&(t=Et,"O-O"===n.substr(Et,3)?(e="O-O",Et+=3):(e=o,0===Tt&&Pt(In)),e!==o?((r=pe())===o&&(r=null),r!==o?(t,t=e=function(n){var t={};return t.notation="O-O"+(n||""),t.check=n||null,t}(r)):(Et=t,t=o)):(Et=t,t=o))))),t}function pe(){var t,e,r,i;return t=Et,e=Et,r=Et,Tt++,"+-"===n.substr(Et,2)?(i="+-",Et+=2):(i=o,0===Tt&&Pt(Dn)),Tt--,i===o?r=void 0:(Et=r,r=o),r!==o?(43===n.charCodeAt(Et)?(i="+",Et++):(i=o,0===Tt&&Pt(Un)),i!==o?e=r=[r,i]:(Et=e,e=o)):(Et=e,e=o),e!==o&&(t,e=Bn(e)),(t=e)===o&&(t=Et,e=Et,r=Et,Tt++,"$$$"===n.substr(Et,3)?(i="$$$",Et+=3):(i=o,0===Tt&&Pt($n)),Tt--,i===o?r=void 0:(Et=r,r=o),r!==o?(35===n.charCodeAt(Et)?(i="#",Et++):(i=o,0===Tt&&Pt(Mn)),i!==o?e=r=[r,i]:(Et=e,e=o)):(Et=e,e=o),e!==o&&(t,e=Bn(e)),t=e),t}function he(){var t,e,r;return t=Et,61===n.charCodeAt(Et)?(e="=",Et++):(e=o,0===Tt&&Pt(Fn)),e!==o&&(r=function(){var t;ht.test(n.charAt(Et))?(t=n.charAt(Et),Et++):(t=o,0===Tt&&Pt(gt));return t}())!==o?(t,t=e="="+r):(Et=t,t=o),t}function ge(){var t,e,r,i,u,a;return t=Et,(e=function(){var t,e,r;t=Et,36===n.charCodeAt(Et)?(e="$",Et++):(e=o,0===Tt&&Pt(jn));e!==o&&(r=ce())!==o?(t,t=e="$"+r):(Et=t,t=o);t===o&&(t=Et,"!!"===n.substr(Et,2)?(e="!!",Et+=2):(e=o,0===Tt&&Pt(qn)),e!==o&&(t,e="$3"),(t=e)===o&&(t=Et,"??"===n.substr(Et,2)?(e="??",Et+=2):(e=o,0===Tt&&Pt(Wn)),e!==o&&(t,e="$4"),(t=e)===o&&(t=Et,"!?"===n.substr(Et,2)?(e="!?",Et+=2):(e=o,0===Tt&&Pt(Qn)),e!==o&&(t,e="$5"),(t=e)===o&&(t=Et,"?!"===n.substr(Et,2)?(e="?!",Et+=2):(e=o,0===Tt&&Pt(Kn)),e!==o&&(t,e="$6"),(t=e)===o&&(t=Et,33===n.charCodeAt(Et)?(e="!",Et++):(e=o,0===Tt&&Pt(Vn)),e!==o&&(t,e="$1"),(t=e)===o&&(t=Et,63===n.charCodeAt(Et)?(e="?",Et++):(e=o,0===Tt&&Pt(Yn)),e!==o&&(t,e="$2"),(t=e)===o&&(t=Et,8252===n.charCodeAt(Et)?(e="‼",Et++):(e=o,0===Tt&&Pt(Hn)),e!==o&&(t,e="$3"),(t=e)===o&&(t=Et,8263===n.charCodeAt(Et)?(e="⁇",Et++):(e=o,0===Tt&&Pt(Zn)),e!==o&&(t,e="$4"),(t=e)===o&&(t=Et,8265===n.charCodeAt(Et)?(e="⁉",Et++):(e=o,0===Tt&&Pt(zn)),e!==o&&(t,e="$5"),(t=e)===o&&(t=Et,8264===n.charCodeAt(Et)?(e="⁈",Et++):(e=o,0===Tt&&Pt(Xn)),e!==o&&(t,e="$6"),(t=e)===o&&(t=Et,9633===n.charCodeAt(Et)?(e="□",Et++):(e=o,0===Tt&&Pt(Jn)),e!==o&&(t,e="$7"),(t=e)===o&&(t=Et,61===n.charCodeAt(Et)?(e="=",Et++):(e=o,0===Tt&&Pt(Fn)),e!==o&&(t,e="$10"),(t=e)===o&&(t=Et,8734===n.charCodeAt(Et)?(e="∞",Et++):(e=o,0===Tt&&Pt(nt)),e!==o&&(t,e="$13"),(t=e)===o&&(t=Et,10866===n.charCodeAt(Et)?(e="⩲",Et++):(e=o,0===Tt&&Pt(tt)),e!==o&&(t,e="$14"),(t=e)===o&&(t=Et,10865===n.charCodeAt(Et)?(e="⩱",Et++):(e=o,0===Tt&&Pt(et)),e!==o&&(t,e="$15"),(t=e)===o&&(t=Et,177===n.charCodeAt(Et)?(e="±",Et++):(e=o,0===Tt&&Pt(rt)),e!==o&&(t,e="$16"),(t=e)===o&&(t=Et,8723===n.charCodeAt(Et)?(e="∓",Et++):(e=o,0===Tt&&Pt(ot)),e!==o&&(t,e="$17"),(t=e)===o&&(t=Et,"+-"===n.substr(Et,2)?(e="+-",Et+=2):(e=o,0===Tt&&Pt(Dn)),e!==o&&(t,e="$18"),(t=e)===o&&(t=Et,"-+"===n.substr(Et,2)?(e="-+",Et+=2):(e=o,0===Tt&&Pt(it)),e!==o&&(t,e="$19"),(t=e)===o&&(t=Et,10752===n.charCodeAt(Et)?(e="⨀",Et++):(e=o,0===Tt&&Pt(ut)),e!==o&&(t,e="$22"),(t=e)===o&&(t=Et,10227===n.charCodeAt(Et)?(e="⟳",Et++):(e=o,0===Tt&&Pt(at)),e!==o&&(t,e="$32"),(t=e)===o&&(t=Et,8594===n.charCodeAt(Et)?(e="→",Et++):(e=o,0===Tt&&Pt(lt)),e!==o&&(t,e="$36"),(t=e)===o&&(t=Et,8593===n.charCodeAt(Et)?(e="↑",Et++):(e=o,0===Tt&&Pt(ct)),e!==o&&(t,e="$40"),(t=e)===o&&(t=Et,8646===n.charCodeAt(Et)?(e="⇆",Et++):(e=o,0===Tt&&Pt(st)),e!==o&&(t,e="$132"),(t=e)===o&&(t=Et,68===n.charCodeAt(Et)?(e="D",Et++):(e=o,0===Tt&&Pt(ft)),e!==o&&(t,e="$220"),t=e)))))))))))))))))))))))));return t}())!==o?((r=se())===o&&(r=null),r!==o?((i=ge())===o&&(i=null),i!==o?(t,u=e,(a=i||[]).unshift(u),t=e=a):(Et=t,t=o)):(Et=t,t=o)):(Et=t,t=o),t}function de(){var n;return(n=Ae())===o&&(n=be()),n}function me(){var t;return vt.test(n.charAt(Et))?(t=n.charAt(Et),Et++):(t=o,0===Tt&&Pt(pt)),t}function Ae(){var t;return dt.test(n.charAt(Et))?(t=n.charAt(Et),Et++):(t=o,0===Tt&&Pt(mt)),t}function be(){var t;return At.test(n.charAt(Et))?(t=n.charAt(Et),Et++):(t=o,0===Tt&&Pt(bt)),t}function Ce(){var t;return 120===n.charCodeAt(Et)?(t="x",Et++):(t=o,0===Tt&&Pt(Ct)),t}if((e=u())!==o&&Et===n.length)return e;throw e!==o&&Et<n.length&&Pt({type:"end"}),Gt(Nt,St<n.length?n.charAt(St):null,St<n.length?wt(St,St+1):wt(St,St))}}},function(n,t,e){var r,o=function(n){var t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",e=["1-0","0-1","1/2-1/2","*"],r={b:[16,32,17,15],w:[-16,-32,-17,-15]},o={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},i=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],u=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],a={p:0,n:1,b:2,r:3,q:4,k:5},l={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},c={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},s={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},f={w:[{square:s.a1,flag:c.QSIDE_CASTLE},{square:s.h1,flag:c.KSIDE_CASTLE}],b:[{square:s.a8,flag:c.QSIDE_CASTLE},{square:s.h8,flag:c.KSIDE_CASTLE}]},v=new Array(128),p={w:-1,b:-1},h="w",g={w:0,b:0},d=-1,m=0,A=1,b=[],C={};function E(n){void 0===n&&(n=!1),v=new Array(128),p={w:-1,b:-1},h="w",g={w:0,b:0},d=-1,m=0,A=1,b=[],n||(C={}),x(T())}function y(){S(t)}function S(n,t){void 0===t&&(t=!1);var e=n.split(/\s+/),r=e[0],o=0;if(!N(n).valid)return!1;E(t);for(var i=0;i<r.length;i++){var u=r.charAt(i);if("/"===u)o+=8;else if(-1!=="0123456789".indexOf(u))o+=parseInt(u,10);else{var a=u<"a"?"w":"b";k({type:u.toLowerCase(),color:a},K(o)),o++}}return h=e[1],e[2].indexOf("K")>-1&&(g.w|=c.KSIDE_CASTLE),e[2].indexOf("Q")>-1&&(g.w|=c.QSIDE_CASTLE),e[2].indexOf("k")>-1&&(g.b|=c.KSIDE_CASTLE),e[2].indexOf("q")>-1&&(g.b|=c.QSIDE_CASTLE),d="-"===e[3]?-1:s[e[3]],m=parseInt(e[4],10),A=parseInt(e[5],10),x(T()),!0}function N(n){var t="No errors.",e="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",u="3rd field (castling availability) is invalid.",a="2nd field (side to move) is invalid.",l="1st field (piece positions) does not contain 8 '/'-delimited rows.",c="1st field (piece positions) is invalid [consecutive numbers].",s="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",v="Illegal en-passant square",p=n.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:e};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:u};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:a};var h=p[0].split("/");if(8!==h.length)return{valid:!1,error_number:7,error:l};for(var g=0;g<h.length;g++){for(var d=0,m=!1,A=0;A<h[g].length;A++)if(isNaN(h[g][A])){if(!/^[prnbqkPRNBQK]$/.test(h[g][A]))return{valid:!1,error_number:9,error:s};d+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:c};d+=parseInt(h[g][A],10),m=!0}if(8!==d)return{valid:!1,error_number:10,error:f}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:v}:{valid:!0,error_number:0,error:t}}function T(){for(var n=0,t="",e=s.a8;e<=s.h1;e++){if(null==v[e])n++;else{n>0&&(t+=n,n=0);var r=v[e].color,o=v[e].type;t+="w"===r?o.toUpperCase():o.toLowerCase()}e+1&136&&(n>0&&(t+=n),e!==s.h1&&(t+="/"),n=0,e+=8)}var i="";g.w&c.KSIDE_CASTLE&&(i+="K"),g.w&c.QSIDE_CASTLE&&(i+="Q"),g.b&c.KSIDE_CASTLE&&(i+="k"),g.b&c.QSIDE_CASTLE&&(i+="q"),i=i||"-";var u=-1===d?"-":K(d);return[t,h,i,u,m,A].join(" ")}function _(n){for(var t=0;t<n.length;t+=2)"string"==typeof n[t]&&"string"==typeof n[t+1]&&(C[n[t]]=n[t+1]);return C}function x(n){b.length>0||(n!==t?(C.SetUp="1",C.FEN=n):(delete C.SetUp,delete C.FEN))}function O(n){var t=v[s[n]];return t?{type:t.type,color:t.color}:null}function k(n,t){if(!("type"in n)||!("color"in n))return!1;if(-1==="pnbrqkPNBRQK".indexOf(n.type.toLowerCase()))return!1;if(!(t in s))return!1;var e=s[t];return("k"!=n.type||-1==p[n.color]||p[n.color]==e)&&(v[e]={type:n.type,color:n.color},"k"===n.type&&(p[n.color]=e),x(T()),!0)}function w(n,t,e,r,o){var i={color:h,from:t,to:e,flags:r,piece:n[t].type};return o&&(i.flags|=c.PROMOTION,i.promotion=o),n[e]?i.captured=n[e].type:r&c.EP_CAPTURE&&(i.captured="p"),i}function P(n){function t(n,t,e,r,o){if("p"!==n[e].type||0!==W(r)&&7!==W(r))t.push(w(n,e,r,o));else for(var i=["q","r","b","n"],u=0,a=i.length;u<a;u++)t.push(w(n,e,r,o,i[u]))}var e=[],i=h,u=V(i),a={b:1,w:6},l=s.a8,f=s.h1,m=!1,A=void 0===n||!("legal"in n)||n.legal;if(void 0!==n&&"square"in n){if(!(n.square in s))return[];l=f=s[n.square],m=!0}for(var b=l;b<=f;b++)if(136&b)b+=7;else{var C=v[b];if(null!=C&&C.color===i)if("p"===C.type){var E=b+r[i][0];if(null==v[E]){t(v,e,b,E,c.NORMAL);E=b+r[i][1];a[i]===W(b)&&null==v[E]&&t(v,e,b,E,c.BIG_PAWN)}for(y=2;y<4;y++){136&(E=b+r[i][y])||(null!=v[E]&&v[E].color===u?t(v,e,b,E,c.CAPTURE):E===d&&t(v,e,b,d,c.EP_CAPTURE))}}else for(var y=0,S=o[C.type].length;y<S;y++){var N=o[C.type][y];for(E=b;!(136&(E+=N));){if(null!=v[E]){if(v[E].color===i)break;t(v,e,b,E,c.CAPTURE);break}if(t(v,e,b,E,c.NORMAL),"n"===C.type||"k"===C.type)break}}}if(!m||f===p[i]){if(g[i]&c.KSIDE_CASTLE){var T=(_=p[i])+2;null!=v[_+1]||null!=v[T]||R(u,p[i])||R(u,_+1)||R(u,T)||t(v,e,p[i],T,c.KSIDE_CASTLE)}if(g[i]&c.QSIDE_CASTLE){var _;T=(_=p[i])-2;null!=v[_-1]||null!=v[_-2]||null!=v[_-3]||R(u,p[i])||R(u,_-1)||R(u,T)||t(v,e,p[i],T,c.QSIDE_CASTLE)}}if(!A)return e;var x=[];for(b=0,S=e.length;b<S;b++)F(e[b]),I(i)||x.push(e[b]),j();return x}function G(n,t){var e="";if(n.flags&c.KSIDE_CASTLE)e="O-O";else if(n.flags&c.QSIDE_CASTLE)e="O-O-O";else{var r=function(n,t){for(var e=P({legal:!t}),r=n.from,o=n.to,i=n.piece,u=0,a=0,l=0,c=0,s=e.length;c<s;c++){var f=e[c].from,v=e[c].to,p=e[c].piece;i===p&&r!==f&&o===v&&(u++,W(r)===W(f)&&a++,Q(r)===Q(f)&&l++)}if(u>0)return a>0&&l>0?K(r):l>0?K(r).charAt(1):K(r).charAt(0);return""}(n,t);"p"!==n.piece&&(e+=n.piece.toUpperCase()+r),n.flags&(c.CAPTURE|c.EP_CAPTURE)&&("p"===n.piece&&(e+=K(n.from)[0]),e+="x"),e+=K(n.to),n.flags&c.PROMOTION&&(e+="="+n.promotion.toUpperCase())}return F(n),D()&&(U()?e+="#":e+="+"),j(),e}function L(n){return n.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function R(n,t){for(var e=s.a8;e<=s.h1;e++)if(136&e)e+=7;else if(null!=v[e]&&v[e].color===n){var r=v[e],o=e-t,l=o+119;if(i[l]&1<<a[r.type]){if("p"===r.type){if(o>0){if("w"===r.color)return!0}else if("b"===r.color)return!0;continue}if("n"===r.type||"k"===r.type)return!0;for(var c=u[l],f=e+c,p=!1;f!==t;){if(null!=v[f]){p=!0;break}f+=c}if(!p)return!0}}return!1}function I(n){return R(V(n),p[n])}function D(){return I(h)}function U(){return D()&&0===P().length}function B(){return!D()&&0===P().length}function $(){for(var n={},t=[],e=0,r=0,o=s.a8;o<=s.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var i=v[o];i&&(n[i.type]=i.type in n?n[i.type]+1:1,"b"===i.type&&t.push(r),e++)}if(2===e)return!0;if(3===e&&(1===n.b||1===n.n))return!0;if(e===n.b+2){var u=0,a=t.length;for(o=0;o<a;o++)u+=t[o];if(0===u||u===a)return!0}return!1}function M(){for(var n=[],t={},e=!1;;){var r=j();if(!r)break;n.push(r)}for(;;){var o=T().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(e=!0),!n.length)break;F(n.pop())}return e}function F(n){var t=h,e=V(t);if(function(n){b.push({move:n,kings:{b:p.b,w:p.w},turn:h,castling:{b:g.b,w:g.w},ep_square:d,half_moves:m,move_number:A})}(n),v[n.to]=v[n.from],v[n.from]=null,n.flags&c.EP_CAPTURE&&("b"===h?v[n.to-16]=null:v[n.to+16]=null),n.flags&c.PROMOTION&&(v[n.to]={type:n.promotion,color:t}),"k"===v[n.to].type){if(p[v[n.to].color]=n.to,n.flags&c.KSIDE_CASTLE){var r=n.to-1,o=n.to+1;v[r]=v[o],v[o]=null}else if(n.flags&c.QSIDE_CASTLE){r=n.to+1,o=n.to-2;v[r]=v[o],v[o]=null}g[t]=""}if(g[t])for(var i=0,u=f[t].length;i<u;i++)if(n.from===f[t][i].square&&g[t]&f[t][i].flag){g[t]^=f[t][i].flag;break}if(g[e])for(i=0,u=f[e].length;i<u;i++)if(n.to===f[e][i].square&&g[e]&f[e][i].flag){g[e]^=f[e][i].flag;break}d=n.flags&c.BIG_PAWN?"b"===h?n.to-16:n.to+16:-1,"p"===n.piece||n.flags&(c.CAPTURE|c.EP_CAPTURE)?m=0:m++,"b"===h&&A++,h=V(h)}function j(){var n=b.pop();if(null==n)return null;var t=n.move;p=n.kings,h=n.turn,g=n.castling,d=n.ep_square,m=n.half_moves,A=n.move_number;var e,r,o=h,i=V(h);if(v[t.from]=v[t.to],v[t.from].type=t.piece,v[t.to]=null,t.flags&c.CAPTURE)v[t.to]={type:t.captured,color:i};else if(t.flags&c.EP_CAPTURE){var u;u="b"===o?t.to-16:t.to+16,v[u]={type:"p",color:i}}t.flags&(c.KSIDE_CASTLE|c.QSIDE_CASTLE)&&(t.flags&c.KSIDE_CASTLE?(e=t.to+1,r=t.to-1):t.flags&c.QSIDE_CASTLE&&(e=t.to-2,r=t.to+1),v[e]=v[r],v[r]=null);return t}function q(n,t){var e=L(n);if(t){var r=e.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var o=r[1],i=r[2],u=r[3],a=r[4]}for(var l=P(),c=0,f=l.length;c<f;c++){if(e===L(G(l[c]))||t&&e===L(G(l[c],!0)))return l[c];if(r&&(!o||o.toLowerCase()==l[c].piece)&&s[i]==l[c].from&&s[u]==l[c].to&&(!a||a.toLowerCase()==l[c].promotion))return l[c]}return null}function W(n){return n>>4}function Q(n){return 15&n}function K(n){var t=Q(n),e=W(n);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function V(n){return"w"===n?"b":"w"}function Y(n){var t=function n(t){var e=t instanceof Array?[]:{};for(var r in t)e[r]="object"==typeof r?n(t[r]):t[r];return e}(n);t.san=G(t,!1),t.to=K(t.to),t.from=K(t.from);var e="";for(var r in c)c[r]&t.flags&&(e+=l[r]);return t.flags=e,t}function H(n){return n.replace(/^\s+|\s+$/g,"")}return S(void 0===n?t:n),{WHITE:"w",BLACK:"b",PAWN:"p",KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:"k",SQUARES:function(){for(var n=[],t=s.a8;t<=s.h1;t++)136&t?t+=7:n.push(K(t));return n}(),FLAGS:l,load:function(n){return S(n)},reset:function(){return y()},moves:function(n){for(var t=P(n),e=[],r=0,o=t.length;r<o;r++)void 0!==n&&"verbose"in n&&n.verbose?e.push(Y(t[r])):e.push(G(t[r],!1));return e},in_check:function(){return D()},in_checkmate:function(){return U()},in_stalemate:function(){return B()},in_draw:function(){return m>=100||B()||$()||M()},insufficient_material:function(){return $()},in_threefold_repetition:function(){return M()},game_over:function(){return m>=100||U()||B()||$()||M()},validate_fen:function(n){return N(n)},fen:function(){return T()},board:function(){for(var n=[],t=[],e=s.a8;e<=s.h1;e++)null==v[e]?t.push(null):t.push({type:v[e].type,color:v[e].color}),e+1&136&&(n.push(t),t=[],e+=8);return n},pgn:function(n){var t="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\n",e="object"==typeof n&&"number"==typeof n.max_width?n.max_width:0,r=[],o=!1;for(var i in C)r.push("["+i+' "'+C[i]+'"]'+t),o=!0;o&&b.length&&r.push(t);for(var u=[];b.length>0;)u.push(j());for(var a=[],l="";u.length>0;){var c=u.pop();b.length||"b"!==c.color?"w"===c.color&&(l.length&&a.push(l),l=A+"."):l=A+". ...",l=l+" "+G(c,!1),F(c)}if(l.length&&a.push(l),void 0!==C.Result&&a.push(C.Result),0===e)return r.join("")+a.join(" ");var s=0;for(i=0;i<a.length;i++)s+a[i].length>e&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(t),s=0):0!==i&&(r.push(" "),s++),r.push(a[i]),s+=a[i].length;return r.join("")},load_pgn:function(n,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy;function o(n){return n.replace(/\\/g,"\\")}var i="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",u=new RegExp("^(\\[((?:"+o(i)+")|.)*\\])(?:"+o(i)+"){2}"),a=u.test(n)?u.exec(n)[1]:"";y();var l=function(n,t){for(var e="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",r={},i=n.split(new RegExp(o(e))),u="",a="",l=0;l<i.length;l++)u=i[l].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=i[l].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),H(u).length>0&&(r[u]=a);return r}(a,t);for(var c in l)_([c,l[c]]);if(!("1"!==l.SetUp||"FEN"in l&&S(l.FEN,!0)))return!1;var s=n.replace(a,"").replace(new RegExp(o(i),"g")," ");s=s.replace(/(\{[^}]+\})+?/g,"");for(var f=/(\([^\(\)]+\))+?/g;f.test(s);)s=s.replace(f,"");var v=H(s=(s=(s=s.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));v=v.join(",").replace(/,,+/g,",").split(",");for(var p="",h=0;h<v.length-1;h++){if(null==(p=q(v[h],r)))return!1;F(p)}if(p=v[v.length-1],e.indexOf(p)>-1)(function(n){for(var t in n)return!0;return!1})(C)&&void 0===C.Result&&_(["Result",p]);else{if(null==(p=q(p,r)))return!1;F(p)}return!0},header:function(){return _(arguments)},ascii:function(){return function(){for(var n="   +------------------------+\n",t=s.a8;t<=s.h1;t++){if(0===Q(t)&&(n+=" "+"87654321"[W(t)]+" |"),null==v[t])n+=" . ";else{var e=v[t].type;n+=" "+("w"===v[t].color?e.toUpperCase():e.toLowerCase())+" "}t+1&136&&(n+="|\n",t+=8)}return n+="   +------------------------+\n",n+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return h},move:function(n,t){var e=void 0!==t&&"sloppy"in t&&t.sloppy,r=null;if("string"==typeof n)r=q(n,e);else if("object"==typeof n)for(var o=P(),i=0,u=o.length;i<u;i++)if(n.from===K(o[i].from)&&n.to===K(o[i].to)&&(!("promotion"in o[i])||n.promotion===o[i].promotion)){r=o[i];break}if(!r)return null;var a=Y(r);return F(r),a},undo:function(){var n=j();return n?Y(n):null},clear:function(){return E()},put:function(n,t){return k(n,t)},get:function(n){return O(n)},remove:function(n){return function(n){var t=O(n);return v[s[n]]=null,t&&"k"===t.type&&(p[t.color]=-1),x(T()),t}(n)},perft:function(n){return function n(t){for(var e=P({legal:!1}),r=0,o=h,i=0,u=e.length;i<u;i++){if(F(e[i]),!I(o))if(t-1>0)r+=n(t-1);else r++;j()}return r}(n)},square_color:function(n){if(n in s){var t=s[n];return(W(t)+Q(t))%2==0?"light":"dark"}return null},history:function(n){for(var t=[],e=[],r=(void 0!==n&&"verbose"in n&&n.verbose);b.length>0;)t.push(j());for(;t.length>0;){var o=t.pop();r?e.push(Y(o)):e.push(G(o)),F(o)}return e}}};
/* @license
 * Copyright (c) 2018, Jeff Hlywa (jhlywa@gmail.com)
 * Released under the BSD license
 * https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */t.Chess=o,void 0===(r=function(){return o}.call(t,e,t,n))||(n.exports=r)},function(n,t,e){"use strict";e.r(t),e.d(t,"StringBuilder",(function(){return a})),e.d(t,"Utils",(function(){return l})),e.d(t,"pgnReader",(function(){return c}));var r=e(0),o=e.n(r),i=e(1),u=e.n(i);function a(n){let t={};t.strings=new Array("");let e=function(n){n&&t.strings.push(n)};return e(n),{append:e,toString:function(){return t.strings.join("")},isEmpty:function(){for(let n=0;n<t.strings.length;n++)if(t.strings[n].length>0)return!1;return!0},lastChar:function(){return 0===t.strings.length?null:t.strings[t.strings.length-1].slice(-1)}}}function l(){let n=Array.isArray,t=Math.pow(2,53)-1,e=function(n){const e=o(n);return"number"==typeof e&&e>=0&&e<=t},r=n||function(n){return Array.isArray(n)},o=(i="length",function(n){return null==n?void 0:n[i]});var i;return{pvEach:function(n,t,r){let o,i;if(t=function(n,t,e){if(void 0===t)return n;switch(null==e?3:e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,o){return n.call(t,e,r,o)};case 4:return function(e,r,o,i){return n.call(t,e,r,o,i)}}return function(){return n.apply(t,arguments)}}(t,r),e(n))for(o=0,i=n.length;o<i;o++)t(n[o],o,n);else{let e=Object.keys(n);for(o=0,i=e.length;o<i;o++)t(n[e[o]],e[o],n)}return n},pvIsElement:function(n){return!(!n||1!==n.nodeType)},pvIsEmpty:function(n){return null==n||(e(n)&&(r(n)||function(n){return"[object String]"===toString.call(n)}(n)||function(n){return"[object Arguments]"===toString.call(n)}(n))?0===n.length:0===Object.keys(n).length)}}}const c=function(n){const t={};let e=new l;t.configuration=function(n){return void 0===n.pgn&&(void 0===n.pgnFile?n.pgn="":n.pgn=function(n){const t=new XMLHttpRequest;if(t.open("GET",n,!1),t.send(),200===t.status)return t.responseText}(n.pgnFile)),Object.assign({notation:"short",position:"start",locale:"en"},n)}(n),t.startMove=0;const r=new u.a,i=function(){"start"===t.configuration.position?r.reset():r.load(t.configuration.position)};t.PGN_TAGS={event:"the name of the tournament or match event",site:"the location of the event",date:"the starting date of the game (format: YYYY.MM.TT)",round:"the playing round ordinal of the game",white:"the player of the white pieces (last name, pre name)",black:"the player of the black pieces (last name, pre name)",result:"the result of the game (1 - 0, 1/2 - 1/2, 0 - 1)",board:"the board number in a team event",eco:"ECO-Opening-Key (ECO = 'Encyclopaedia of Chess Openings')",whitemyelo:"myELO-score white (at the beginning of the game)",blackmyelo:"myELO-score black (at the beginning of the game)",whitedays:"rate in days for white",blackdays:"rate in days for black",mychessno:"identification-no. of the game on the myChess.de - server",annotator:"The person providing notes to the game.",plycount:"String value denoting total number of half-moves played.",timecontrol:"40/7200:3600 (moves per seconds: sudden death seconds)",time:'Time the game started, in "HH:MM:SS" format, in local clock time.',termination:'Gives more details about the termination of the game. It may be "abandoned", "adjudication" (result determined by third-party adjudication), "death", "emergency", "normal", "rules infraction", "time forfeit", or "unterminated".',mode:'"OTB" (over-the-board) "ICS" (Internet Chess Server)',setup:'"0": position is start position, "1": tag FEN defines the position',fen:'Alternative start position, tag SetUp has to be set to "1"'},t.PROMOTIONS={q:"queen",r:"rook",b:"bishop",n:"knight"},t.NAGs=new Array(220),t.NAGs[1]="!",t.NAGs[2]="?",t.NAGs[3]="‼",t.NAGs[4]="⁇",t.NAGs[5]="⁉",t.NAGs[6]="⁈",t.NAGs[7]="□",t.NAGs[10]="=",t.NAGs[13]="∞",t.NAGs[14]="⩲",t.NAGs[15]="⩱",t.NAGs[16]="±",t.NAGs[17]="∓",t.NAGs[18]="+−",t.NAGs[19]="-+",t.NAGs[22]="⨀",t.NAGs[23]="⨀",t.NAGs[32]="⟳",t.NAGs[33]="⟳",t.NAGs[36]="→",t.NAGs[37]="→",t.NAGs[40]="↑",t.NAGs[41]="↑",t.NAGs[44]="=∞",t.NAGs[132]="⇆",t.NAGs[133]="⇆",t.NAGs[136]="⊕",t.NAGs[140]="∆",t.NAGs[146]="N",t.NAGs[220]="D",t.NAGs[221]="D",t.PGN_NAGS={};for(let n=0;n<t.NAGs.length;n++)t.PGN_NAGS[t.NAGs[n]]=n;t.PGN_NAGS["!!"]=3,t.PGN_NAGS["??"]=4,t.PGN_NAGS["!?"]=5,t.PGN_NAGS["?!"]=6;const c=function(n){let e="";if(null==n)return e;for(let r=0;r<n.length;r++){const o=parseInt(n[r].substring(1));if(220!==o){const n=t.NAGs[o];e+=void 0!==n?n:"$"+o}}return e},s=function(n){return"P"===n?"":n},f=function(n){let e=n.notation;if(void 0===e.row)return e.notation;const r=e.fig?s(e.fig):"",o=e.disc?e.disc:"",i=e.strike?e.strike:"",u=e.check?e.check:"",a=e.mate?e.mate:"",l=e.promotion?"="+s(e.promotion.substring(1,2)):"";return"short"===t.configuration.notation?r+o+i+e.col+e.row+l+u+a:"long"===t.configuration.notation?r+n.from+(e.strike?i:"-")+n.to+l+u+a:void 0};let v=function(){let n=o.a.parse(t.configuration.pgn,{startRule:"game"});if(t.tags=n.tags,function(){if(t.tags.SetUp){const n=t.tags.SetUp;t.configuration.position="0"===n?"start":t.tags.FEN}t.tags.Result&&(t.endGame=t.tags.Result)}(),p(n.moves),t.configuration.startPlay&&t.configuration.hideMovesBefore){let n=b(t.configuration.startPlay),e=E();t.configuration.startPlay=null,t.configuration.hideMovesBefore=!1,t.configuration.pgn=e,t.configuration.position=n,v()}return t};const p=function(n){const r=n;!function(n){"string"==typeof n[n.length-1]&&(t.endGame=n.pop())}(r),y(r),"b"===t.configuration.position.split(/\s+/)[1]&&h(0)&&"w"===t.moves[0].turn&&e.pvEach(N(),(function(n){n.turn="w"===n.turn?"b":"w"})),e.pvEach(N(),(function(n){for(let t=0;t<n.variations.length;t++)n.variations[t]=n.variations[t][0]}))},h=function(n){return N().length>n},g=function(n){if(!h(n))return!0;const t=N()[n];return null===t||(0!==n||!t)&&void 0},d=function(n){return N()[n]},m=function(n,t){if(0===arguments.length){const n=d(0);m(n,0)}else if(n.variationLevel=t,void 0!==n.next&&m(d(n.next),t),n.variations)for(let e=0;e<n.variations.length;e++)m(n.variations[e],t+1)};let A=function(n){const e=function(n,t){const e=n[t];return n.splice(t,1),e};if(g(n))return;if(0===n)return void(t.moves=[]);let r=d(n);if(C(r)){const n=d(d(r.prev).next).variations;for(let t=0;n.length;t++)if(n[t]===r)return e(n,t),void 0!==r.next&&A(r.next),void(N()[r.index]=null)}if(0===r.variations.length)return void 0!==r.next&&null!==r.next&&A(r.next),t.moves[r.prev].next=null,void(t.moves[n]=null);if(r.variations.length>0){void 0!==r.next&&A(r.next);let o=e(r.variations,0),i=o.variationLevel;t.moves[r.prev].next=o.index,t.moves[n]=null,m(o,i-1)}};let b=function(n){let e=function(n){let r=t.moves[n].fen;return t.moves[n]=null,n<=0||e(n-1),r};if(void 0===n)return;if(null===n)return;if(n<=0)return;let r=e(n-1);return d(n).prev=null,r};const C=function(n){return n.variationLevel>0&&("number"!=typeof n.prev||N()[n.prev].next!==n.index)},E=function(){function n(n){n.isEmpty()||" "===n.lastChar()||n.append(" ")}const e=function(t,e){null!=t&&(n(e),e.append("{"),e.append(t),e.append("}"))},r=function(t,e){n(e),e.append("("),o(t,e),n(e),e.append(")")},o=function(t,i){if(null==t)return;!function(n,t){e(n.commentMove,t)}(t,i),function(t,e){n(e),"w"===t.turn?(e.append(""+t.moveNumber),e.append(".")):C(t)&&(e.append(""+t.moveNumber),e.append("..."))}(t,i),function(n,t){e(n.commentBefore,t)}(t,i),function(t,e){n(e),e.append(t.notation.notation)}(t,i),function(n,t){n.nag&&n.nag.forEach((function(n){t.append(n)}))}(t,i),function(n,t){e(n.commentAfter,t)}(t,i),function(n,t){if((n=>n.commentDiag&&(n.commentDiag.colorArrows&&n.commentDiag.colorArrows.length>0||n.commentDiag.colorFields&&n.commentDiag.colorFields.length>0))(n)){let r=a(""),o=!0;r.append("[%csl "),(n=>n.commentDiag.colorFields||[])(n).forEach(n=>{o?r.append(""):r.append(","),o=!1,r.append(n)}),r.append("]"),o=!0,r.append("[%cal "),(n=>n.commentDiag.colorArrows||[])(n).forEach(n=>{o?r.append(""):r.append(","),o=!1,r.append(n)}),r.append("]"),e(r.toString(),t)}}(t,i),function(n,t){for(let e=0;e<n.variations.length;e++)r(n.variations[e],t)}(t,i);const u=function(n){return n.next?d(n.next):null}(t);o(u,i)},i=a("");let u=0;for(;null===d(u);)u+=1;return l=d(u),o(l,c=i),function(n){t.endGame&&(n.append(" "),n.append(t.endGame))}(c),c.toString();var l,c},y=function(n){t.moves=[];let o=-1;const u=function(n,a,l){let c=null!=l?t.moves[l]:null;e.pvEach(n,(function(n,s){o++,n.variationLevel=a,t.moves.push(n),s>0&&(t.moves[o-1].variationLevel>a?(c=function(n,e){for(;e>=0;){if(t.moves[e].variationLevel===n)return t.moves[e];e--}return null}(a,o-1),l=c.index):(l=o-1,c=t.moves[l])),function(n,t,e,r){null!=r&&(e.prev=t,r.next||(r.next=n)),e.index=n}(o,l,n,c),"number"==typeof n.prev?r.load(d(n.prev).fen):i();let f=r.move(n.notation.notation,{sloppy:!0});if(null===f)throw"No legal move: "+n.notation.notation;let v=r.fen();n.fen=v,n.from=f.from,n.to=f.to,n.notation.notation=f.san,"c"===f.flags&&(n.notation.strike="x"),r.in_checkmate()?n.notation.check="#":r.in_check()&&(n.notation.check="+"),n.moveNumber=function(n){const t=n.split(/\s+/),e=parseInt(t[5],10);return"b"===t[1]?e:e-1}(v),e.pvEach(n.variations,(function(n){u(n,a+1,l)}))}))};t.firstMove=n[0],u(n,0,null)};const S=function(n,e){if(0===arguments.length&&(n=d(t.startMove),e=[]),e.push(n),n.variations)for(let t=0;t<n.variations.length;t++)S(n.variations[t],e);return n.next?S(d(n.next),e):e};function N(){return void 0!==t.moves||v(),t.moves}return{configuration:t.configuration,deleteMove:A,deleteMovesBefore:b,isDeleted:g,promoteMove:function(n){const t=function(n){return C(n)?n:t(d(n.prev))},e=d(n);if(void 0===e.variationLevel||0===e.variationLevel)return;const r=t(e),o=d(d(r.prev).next);let i;for(let n=0;n<o.variations.length;n++)o.variations[n]===r&&(i=n);if(i>0){let n=o.variations[i-1];o.variations[i-1]=o.variations[i],o.variations[i]=n}else{let n=o;const t=o.variations;d(o.prev).next=r.index,n.variations=r.variations,r.variations=t,r.variations[0]=n}m()},readMoves:p,findMove:function(n){if(!isNaN(n)){n-=1;let t=d(0);for(;n>0;)n-=1,t=d(t.next);return t}let t=N();for(let e of t){if(e.fen.startsWith(n))return e;if(e.notation.notation===n)return e}},getMoves:N,getOrderedMoves:S,getMove:d,getEndGame:function(){return t.endGame},getTags:function(){return void 0!==t.tags||v(),t.tags},getParser:()=>o.a,movesMainLine:function(){let n=d(t.startMove),e=[];for(e.push(n);n.next;)n=d(n.next),e.push(n);return e},write_pgn:E,nag_to_symbol:c,startVariation:C,startMainLine:function(n){return 0===n.variationLevel&&"number"!=typeof n.prev},endVariation:function(n){return n.variationLevel>0&&!n.next},afterMoveWithVariation:function(n){return N()[n.prev]&&N()[n.prev].variations.length>0},changeNag:function(n,e,r){let o=d(e);null==o.nag&&(o.nag=[]);let i="$"===n[0]?n:function(n){const e=t.PGN_NAGS[n];return"undefined"===e?null:"$"+e}(n);if(r)-1===o.nag.indexOf(i)&&o.nag.push(i);else{let n=o.nag.indexOf(i);n>-1&&o.nag.splice(n,1)}},clearNags:function(n){d(n).nag=[]},addMove:function(n,t){function e(n){i();let t=r.move(n);return void 0===t?null:(void 0===d(0)?null:d(0).notation.notation)===t.san?0:function(n){if(void 0===d(0))return null;let t,e=d(0).variations;for(t in e)if(e[t].notation.notation===n.san)return e[t].moveNumber;return null}(t)}let o=function(n,t){if(null==t)return e(n);let o=d(t);if(void 0===o)return null;r.load(o.fen);let i=r.move(n),u=d(o.next);if(void 0===u)return null;if(u.notation.notation===i.san)return o.next;{let n=d(o.next);for(let t=0;t<n.variations.length;t++){let e=n.variations[t];if(e.notation.notation===i.san)return e.index}}return null}(n,t);if("number"==typeof o)return o;let u={};u.from=n.from,u.to=n.to,u.notation={},u.variations=[],null==t?(i(),u.turn=r.turn(),u.moveNumber=1):(r.load(d(t).fen),u.turn=function(n){return"w"===d(n).turn?"b":"w"}(t),"w"===u.turn?u.moveNumber=d(t).moveNumber+1:u.moveNumber=d(t).moveNumber);let a=r.move(n);u.fen=r.fen(),"O"!==a.san.substring(0,1)?(u.notation.notation=a.san,u.notation.col=a.to.substring(0,1),u.notation.row=a.to.substring(1,2),"p"!==a.piece&&(u.notation.fig=a.piece.charAt(0).toUpperCase()),a.promotion&&(u.notation.promotion="="+a.promotion.toUpperCase()),(a.flags.includes(r.FLAGS.CAPTURE)||a.flags.includes(r.FLAGS.EP_CAPTURE))&&(u.notation.strike="x"),u.notation.ep=a.flags.includes(r.FLAGS.EP_CAPTURE),r.in_check()&&(r.in_checkmate()?u.notation.mate="#":u.notation.check="+")):u.notation.notation=a.san,N().push(u),u.prev=t;let l=N().length-1;return u.index=l,function(n,t,e){let r=d(t);if(void 0===r){if(0===e)return;return d(0).variations.push(n),void(n.variationLevel=1)}r.next?(d(r.next).variations.push(n),n.variationLevel=(r.variationLevel?r.variationLevel:0)+1,"b"===n.turn&&(n.moveNumber=r.moveNumber)):(r.next=e,n.variationLevel=r.variationLevel)}(u,t,l),l},has_diagram_nag:function(n){return void 0!==n.nag&&(null!=n.nag&&n.nag.indexOf("$220")>-1)},PGN_NAGS:t.PGN_NAGS,PROMOTIONS:t.PROMOTIONS,NAGS:t.NAGs,san:f,sanWithNags:function(n){let t=f(n);return n.nag&&(t+=c(n.nag)),t},game:r,load_pgn:v,possibleMoves:function(n){const t={};return n.SQUARES.forEach(e=>{const r=n.moves({square:e,verbose:!0});r.length&&(t[e]=r.map(n=>n.to))}),t},setShapes:function(n,t){n.commentDiag||(n.commentDiag={}),n.commentDiag.colorArrows=[],n.commentDiag.colorFields=[],t.forEach(t=>{if(t.dest){let e=t.brush.slice(0,1).toUpperCase(),r=t.orig+t.dest;n.commentDiag.colorArrows.push(e+r)}else{let e=t.brush.slice(0,1).toUpperCase(),r=t.orig;n.commentDiag.colorFields.push(e+r)}})}}}}])}));
//# sourceMappingURL=pgn.js.map